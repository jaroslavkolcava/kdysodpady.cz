<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Zábřeh – termíny svozu odpadu</title>
  <style>
    :root{
      --border:#d1d5db;
      --muted:#6b7280;
      --panel:#ffffff;
      --cal-h: 600px;
    }
    *{box-sizing:border-box}
    html, body { height: 100%; }
    body{
      font-family:Arial,system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
      margin:0; background:#f3f4f6; color:#111827;
      display:flex; flex-direction:column;
      overflow:hidden;
    }
    h1{margin:16px 0 8px; text-align:center}
    .wrap{
      max-width:1000px; width:100%;
      margin:0 auto 16px;
      background:var(--panel);
      border:1px solid var(--border);
      border-radius:10px;
      padding:10px;
      display:flex; flex-direction:column; gap:8px;
      flex:1; min-height:0;
    }
    .topbar {
      display:flex; justify-content:space-between; align-items:center;
      margin:8px 0 12px; padding:0 10px;
    }
    .month-label {
      font-size:28px; font-weight:700; text-align:center; flex:1;
    }
    .ics-btn, .trasa-sel {
      border:2px solid #2563eb; border-radius:8px;
      padding:6px 12px; font-size:14px; font-weight:600;
      cursor:pointer;
    }
    .ics-btn { background:#2563eb; color:#fff; }
    .ics-btn:hover { background:#1e4f9b; }
    .trasa-sel { background:#fff; color:#2563eb; }

    .toolbar{
      display:flex; gap:10px; justify-content:center; flex-wrap:wrap
    }
    .toolbar select, .toolbar button{
      border:1px solid var(--border); background:#fff; border-radius:8px;
      padding:8px 10px; font-size:14px; cursor:pointer
    }

    .legend{display:flex; flex-wrap:wrap; gap:10px; justify-content:center; margin:4px 0}
    .legend span{display:inline-flex; align-items:center; gap:8px;}
    .legend .sw{width:18px; height:10px; border-radius:999px}

    #calBox{flex:1; min-height:0; overflow:hidden; display:flex;}
    .calendar{
      width:100%; border-collapse:collapse; table-layout:fixed;
      height:var(--cal-h); background:#fff;
    }
    .calendar th, .calendar td{
      border:1px solid var(--border); text-align:left; vertical-align:top;
      width:14.285%; padding:8px 8px 6px;
    }
    .calendar thead th{height:40px; background:#f9fafb; font-weight:600}
    .calendar tbody td { height: calc((var(--cal-h) - 40px) / 6); }
    .daynum{font-weight:600; margin-bottom:6px}
    .event{display:block; margin:3px 0; padding:3px 8px; border-radius:8px;
      color:#fff; font-size:13px; text-align:center;}
    .smesny{background:#111}
    .bio{background:#6b3b00}
    .papir{background:#0057ff}
    .plasty{background:#ffe600; color:#111; border:1px solid #d1a800}
    .sklo{background:#1c7c1a}
    .kovy{background:#7a7a7a}
    .calendar td.today{box-shadow: inset 0 0 0 2px #2563eb;}
  </style>
</head>
<body>
  <h1>
    <div style="font-size:36px;font-weight:700;">Zábřeh</div>
    <div style="font-size:30px;font-weight:400;">Termíny svozu odpadu</div>
  </h1>

  <div class="wrap">
    <div class="topbar">
      <button id="icsBtn" class="ics-btn">Stáhnout .ics</button>
      <div id="monthLabel" class="month-label"></div>
      <select id="trasaSel" class="trasa-sel">
        <option value="I">Trasa I</option>
        <option value="II">Trasa II</option>
        <option value="III">Trasa III</option>
        <option value="IV">Trasa IV</option>
      </select>
    </div>

    <div class="toolbar">
      <button id="prevBtn">&#8592;</button>
      <select id="monthSel"></select>
      <select id="yearSel"></select>
      <button id="nextBtn">&#8594;</button>
      <button id="todayBtn">Dnes</button>
    </div>

    <div class="legend">
      <span><i class="sw smesny"></i> Směsný</span>
      <span><i class="sw bio"></i> Bio</span>
      <span><i class="sw papir"></i> Papír</span>
      <span><i class="sw plasty"></i> Plasty</span>
      <span><i class="sw sklo"></i> Sklo</span>
      <span><i class="sw kovy"></i> Kovy</span>
    </div>

    <div id="calBox">
      <table class="calendar">
        <thead>
          <tr><th>Po</th><th>Út</th><th>St</th><th>Čt</th><th>Pá</th><th>So</th><th>Ne</th></tr>
        </thead>
        <tbody id="calBody"></tbody>
      </table>
    </div>
  </div>

<script>
(function(){
  // === DATA pro Zábřeh – zatím prázdné, doplníme ===
  const EVENTS = {
    I: { smesny:[], plasty:[], papir:[], bio:[], sklo:[], kovy:[] },
    II:{ smesny:[], plasty:[], papir:[], bio:[], sklo:[], kovy:[] },
    III:{ smesny:[], plasty:[], papir:[], bio:[], sklo:[], kovy:[] },
    IV:{ smesny:[], plasty:[], papir:[], bio:[], sklo:[], kovy:[] }
  };

  let currentTrasa = "I";

  const monthNames = ["Leden","Únor","Březen","Duben","Květen","Červen","Červenec","Srpen","Září","Říjen","Listopad","Prosinec"];
  const monthSel=document.getElementById("monthSel");
  const yearSel=document.getElementById("yearSel");
  const label=document.getElementById("monthLabel");
  const body=document.getElementById("calBody");
  const prevBtn=document.getElementById("prevBtn");
  const nextBtn=document.getElementById("nextBtn");
  const todayBtn=document.getElementById("todayBtn");
  const calBox=document.getElementById("calBox");
  const icsBtn=document.getElementById("icsBtn");
  const trasaSel=document.getElementById("trasaSel");

  const today=new Date();
  const NOW_MONTH=today.getMonth();
  const NOW_YEAR=today.getFullYear();
  const TODAY_KEY=today.toISOString().slice(0,10);

  for(let m=0;m<12;m++){let opt=document.createElement("option");opt.value=m;opt.textContent=monthNames[m];monthSel.appendChild(opt);}
  for(let y=NOW_YEAR-3;y<=NOW_YEAR+3;y++){let opt=document.createElement("option");opt.value=y;opt.textContent=y;yearSel.appendChild(opt);}
  let selMonth=NOW_MONTH, selYear=NOW_YEAR;
  monthSel.value=selMonth; yearSel.value=selYear;

  function render(y,m){
    label.textContent=monthNames[m]+" "+y;
    body.innerHTML="";
    const daysInMonth=new Date(y,m+1,0).getDate();
    const first=new Date(y,m,1);
    let startIdx=first.getDay(); startIdx=(startIdx===0?6:startIdx-1);
    let day=1;
    for(let r=0;r<6;r++){
      const tr=document.createElement("tr");
      for(let c=0;c<7;c++){
        const td=document.createElement("td");
        if((r===0&&c<startIdx)||day>daysInMonth){td.innerHTML="&nbsp;";}
        else{
          const d=String(day).padStart(2,"0");
          const mm=String(m+1).padStart(2,"0");
          const key=`${y}-${mm}-${d}`;
          if(key===TODAY_KEY) td.classList.add("today");
          const top=document.createElement("div"); top.className="daynum"; top.textContent=day; td.appendChild(top);
          Object.keys(EVENTS[currentTrasa]).forEach(type=>{
            if(EVENTS[currentTrasa][type].includes(key)){
              const ev=document.createElement("span");
              ev.className=`event ${type}`;
              ev.textContent=type.charAt(0).toUpperCase()+type.slice(1);
              td.appendChild(ev);
            }
          });
          day++;
        }
        tr.appendChild(td);
      }
      body.appendChild(tr);
      if(day>daysInMonth) break;
    }
  }
  monthSel.addEventListener("change",()=>{selMonth=+monthSel.value;render(selYear,selMonth);});
  yearSel.addEventListener("change",()=>{selYear=+yearSel.value;render(selYear,selMonth);});
  prevBtn.addEventListener("click",()=>{selMonth--;if(selMonth<0){selMonth=11;selYear--;}monthSel.value=selMonth;yearSel.value=selYear;render(selYear,selMonth);});
  nextBtn.addEventListener("click",()=>{selMonth++;if(selMonth>11){selMonth=0;selYear++;}monthSel.value=selMonth;yearSel.value=selYear;render(selYear,selMonth);});
  todayBtn.addEventListener("click",()=>{selMonth=NOW_MONTH;selYear=NOW_YEAR;monthSel.value=selMonth;yearSel.value=selYear;render(selYear,selMonth);});
  trasaSel.addEventListener("change",()=>{currentTrasa=trasaSel.value;render(selYear,selMonth);});

  // export .ics jen pro aktuální trasu
  icsBtn.addEventListener("click",()=>{
    let ics="BEGIN:VCALENDAR\nVERSION:2.0\nCALSCALE:GREGORIAN\nMETHOD:PUBLISH\n";
    Object.keys(EVENTS[currentTrasa]).forEach(type=>{
      EVENTS[currentTrasa][type].forEach(d=>{
        ics+="BEGIN:VEVENT\n";
        ics+=`SUMMARY:${type}\n`;
        ics+=`DTSTART;VALUE=DATE:${d.replace(/-/g,"")}\n`;
        ics+=`DTEND;VALUE=DATE:${d.replace(/-/g,"")}\n`;
        ics+="END:VEVENT\n";
      });
    });
    ics+="END:VCALENDAR";
    const blob=new Blob([ics],{type:"text/calendar"});
    const a=document.createElement("a");
    a.href=URL.createObjectURL(blob);
    a.download=`svoz-zabreh-trasa-${currentTrasa}.ics`;
    a.click();
  });

  render(selYear,selMonth);
})();
</script>
</body>
</html>
